<style>
  .sort-button {
    background-color: white;
  }
</style>
<div class="padding">
  <form
    class="form-group"
    ng-submit="getAll(1, sortBy, sortForm, statusFilterToSend)"
  >
    <div class="row">
      <div class="col-sm-1">Search:</div>
      <div class="col-sm-2">
        <div class="input-group input-group-sm mb-3">
          <input
            type="search"
            class="form-control"
            placeholder="Seach here..."
            aria-label="Small"
            aria-describedby="inputGroup-sizing-sm"
            ng-model="search"
            ng-change="clearSearchBox()"
          />
        </div>
      </div>
      <div class="col-sm-2">
        <button class="btn btn-success btn-sm" type="submit">Search</button>
      </div>
      <div class="col-sm-1">
        <label class="form-control-label"><strong>Status :</strong></label>
      </div>
      <div class="col-sm-2">
        <select
          class="custom-select"
          id="status_filter"
          style="width: 100%"
          ng-model="statusFilter"
          ng-change="filterByStatus()"
        >
          <option value="">
            ({{aggregateStatus.All ? aggregateStatus.All : 0}}) All
          </option>
          <option value="blank">
            ({{aggregateStatus.Blank ? aggregateStatus.Blank : 0}}) Blank
          </option>
          <option value="HotLead">
            ({{aggregateStatus.HotLead ? aggregateStatus.HotLead : 0}}) Hot Lead
          </option>
          <option value="WarmLead">
            ({{aggregateStatus.WarmLead ? aggregateStatus.WarmLead : 0}}) Warm
            Lead
          </option>
          <option value="ColdLead">
            ({{aggregateStatus.ColdLead ? aggregateStatus.ColdLead : 0}}) Cold
            Lead
          </option>
          <option value="DeadLead">
            ({{aggregateStatus.DeadLead ? aggregateStatus.DeadLead : 0}}) Dead
            Lead
          </option>
          <option value="First_discussion_pending">
            ({{aggregateStatus.First_discussion_pending ?
            aggregateStatus.First_discussion_pending : 0}}) First discussion
            pending
          </option>
        </select>
      </div>
      <div class="col-sm-1">
        <label class="form-control-label"><strong>Sub Status :</strong></label>
      </div>
      <div class="col-sm-2">
        <select
          class="custom-select"
          id="sub_status_filter"
          style="width: 100%"
          ng-model="subStatusFilter"
          ng-change="filterByStatus()"
        >
          <option value="">-</option>
          <option
            ng-repeat="sub in subStatuses[statusFilter] track by $index"
            value="{{sub}}"
          >
            ({{aggregateSubStatus[sub] ? aggregateSubStatus[sub] : 0}}) {{sub}}
          </option>
        </select>
      </div>
    </div>
  </form>

  <div
    class="row"
    style="
      margin-top: 5px !important;
      background: white;
      padding-top: 10px;
      border-radius: 10px;
    "
  >
    <div class="col-md-12" style="margin: auto">
      <h4 class="text-center" style="color: #9e9e9e; margin: 10px 0 20px 0">
        List of Consultations
      </h4>
      <div
        class="mb-3 d-flex flex-row justify-content-center align-items-center"
        style="width: 100%"
        ng-show="$root.isAuthorised(['Super Admin','Moderator','Deo','Sales Marketing'])"
      >
        Total Results :
        <strong>{{totalRecords}}</strong>
      </div>
      <table class="table table-striped table-responsive">
        <thead>
          <tr class="text-nowrap">
            <th scope="col">#</th>
            <th scope="col">
              Name
              <span>
                <button
                  ng-class="(sortBy === 'name' && sortForm === 1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('name', 1)"
                >
                  &uarr;
                </button>
                <button
                  ng-class="(sortBy === 'name' && sortForm === -1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('name', -1)"
                >
                  &darr;
                </button>
              </span>
            </th>
            <th scope="col">
              Email
              <span>
                <button
                  ng-class="(sortBy === 'email' && sortForm === 1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('email', 1)"
                >
                  &uarr;
                </button>
                <button
                  ng-class="(sortBy === 'email' && sortForm === -1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('email', -1)"
                >
                  &darr;
                </button>
              </span>
            </th>
            <th scope="col">Number</th>
            <th scope="col">Inquiry About</th>
            <th scope="col">Location</th>
            <th scope="col">User Type</th>
            <th scope="col">
              Last Modified
              <span>
                <button
                  ng-class="(sortBy === 'updated' && sortForm === 1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('updated', 1)"
                >
                  &uarr;
                </button>
                <button
                  ng-class="(sortBy === 'updated' && sortForm === -1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('updated', -1)"
                >
                  &darr;
                </button>
              </span>
            </th>
            <th scope="col">
              Created
              <span>
                <button
                  ng-class="(sortBy === 'created' && sortForm === 1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('created', 1)"
                >
                  &uarr;
                </button>
                <button
                  ng-class="(sortBy === 'created' && sortForm === -1) ? 'btn btn-sm':'btn btn-sm sort-button'"
                  ng-click="changeSort('created', -1)"
                >
                  &darr;
                </button>
              </span>
            </th>
            <th scope="col">Status</th>
            <th scope="col">Sub Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- <tr ng-repeat="user in usersList track by $index">
                                                                        <th>{{((pageIndex-1)*10)+$index+1}}</th>
                                                                        <td>{{user.username}}</td>
                                                                        <td>{{user.email}}</td>
                                                                        <td>{{user.username}}</td>
                                                                        <td>{{user.inquiry_about}}</td>
                                                                        <td>{{user.city}}</td>
                                                                    </tr> -->
          <tr ng-repeat="user in usersList track by $index">
            <th>{{((pageIndex-1)*10)+$index+1}}</th>
            <td>{{user.name}}</td>
            <td>{{user.email}}</td>
            <td>({{user.country.code}})&nbsp;{{user.phone}}</td>
            <td>{{user.lookingFor}}</td>
            <td>{{user.city}}</td>
            <td>{{user.type_of_user}}</td>
            <td>{{user.updated | date :'dd MMMM yy, hh:mm a'}}</td>
            <td>{{user.created | date :'dd MMMM yy, hh:mm a'}}</td>
            <td>{{user.latestStatus}}</td>
            <td>{{user.latestSubStatus}}</td>
            <td
              class="d-flex flex-row justify-content-between"
              style="width: 180px"
            >
              <p
                class="btn btn-sm btn-primary mb-0 cursor-pointer"
                ng-click="showNotesModal(user)"
              >
                Add notes
              </p>
              <p
                class="btn btn-sm btn-secondary mb-0 cursor-pointer"
                ng-click="showHistoryModal(user)"
              >
                History
              </p>
            </td>
          </tr>
          <tr></tr>
        </tbody>
      </table>

      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
          <li
            class="page-item"
            data-ng-show="currentArrayIndex != 0"
            data-ng-click="previousPaginationArray()"
          >
            <a class="page-link" href="" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
              <span class="sr-only">Previous</span>
            </a>
          </li>
          <li
            class="page-item"
            data-ng-repeat="i in mainArray[currentArrayIndex] track by $index"
          >
            <a
              ng-if="i === pageIndex"
              style="color: blue !important; font-weight: bold !important"
              class="page-link"
              href=""
              data-ng-bind="i"
              data-ng-click="getAll(i, sortBy, sortForm, statusFilterToSend)"
            ></a>
            <a
              ng-if="i !== pageIndex"
              class="page-link"
              href=""
              data-ng-bind="i"
              data-ng-click="getAll(i, sortBy, sortForm, statusFilterToSend)"
            ></a>
          </li>
          <li
            class="page-item"
            data-ng-show="currentArrayIndex != mainArray.length-1"
            data-ng-click="nextPaginationArray()"
          >
            <a class="page-link" href="" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
              <span class="sr-only">Next</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Add notes Modal -->
<div
  class="modal fade"
  id="addNotesModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="addNotesModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addNotesModalLabel">Add a Note</h5>
        <button
          type="button"
          ng-click="blankFormFn()"
          id="closeCreateEditModal"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body add-notes-modal-body">
        <form
          name="addNotesForm"
          class="form-horizontal"
          ng-submit="saveNotes()"
        >
          <div class="form-group">
            <label for="consult-status">Status</label
            ><span style="color: red"> *</span>
            <select
              class="custom-select w-100"
              ng-model="consult.status"
              id="consult-status"
              required
            >
              <option value="HotLead">Hot Lead</option>
              <option value="WarmLead">Warm Lead</option>
              <option value="ColdLead">Cold Lead</option>
              <option value="DeadLead">Dead Lead</option>
              <option value="First_discussion_pending">
                First discussion pending
              </option>
            </select>
          </div>
          <div class="form-group" data-ng-show="consult.status">
            <label for="consult-substatus">Sub Status</label>
            <span style="color: red">*</span>
            <select
              class="form-control"
              type="text"
              placeholder="date"
              id="consult-substatus"
              ng-model="consult.subStatus"
              required
            >
              <option
                data-ng-repeat="sub_status in subStatuses[consult.status] track by $index"
                value="{{sub_status}}"
                ng-attr-selected="sub_status === consult.subStatus"
              >
                {{sub_status}}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="username">Whatsapp Number</label>
            <!-- <span style="color: red">*</span> -->
            <div
              class="form-group row justify-content-between w-100 mx-0"
              style="position: relative"
            >
              <div
                ng-click="showPhoneCodeOptions('code', 'code-name', 'phone-code-list', 'phone-code-search')"
                class="position-relative form-control col-3 p-0 ps-1 d-flex justify-content-around align-items-center"
              >
                <input
                  type="text"
                  class="w-100 mb-0 border-0 text-center"
                  name="countryCode"
                  id="code"
                  ng-model="phoneCode"
                  readonly="readonly"
                  required
                  style="margin-bottom: 0px !important"
                />
                <input
                  id="phone-code-search"
                  type="text"
                  placeholder="India"
                  ng-model="phoneCodeSearchText"
                  class="phone-code-search w-100 p-2 mb-0 border-0 text-center"
                  style="display: none"
                />
                <input
                  type="text"
                  class="w-100 d-none"
                  name="countryName"
                  id="code-name"
                  ng-model="phoneCodeName"
                  readonly="readonly"
                  required
                />
                <svg
                  class="m-1"
                  stroke="currentColor"
                  fill="none"
                  stroke-width="2"
                  viewBox="0 0 20 20"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  height="18"
                  width="18"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div
                id="phone-code-list"
                class="phone-code-list bottom-0"
                style="display: none; position: absolute"
              >
                <div class="w-100 p-2"></div>
                <table class="p-2"></table>
              </div>
              <input
                class="form-control col-8"
                type="text"
                onkeypress="return event.keyCode === 8 || event.charCode >= 48 && event.charCode <= 57"
                ng-model="consult.whatsappNumber"
                placeholder="Whatsapp Number"
                id="whatsapp-number"
                required
              />
            </div>
          </div>
          <div class="form-group">
            <label for="notes">Notes</label>
            <!-- <span style="color: red"> *</span> -->
            <textarea
              id="consult-notes"
              name="notes"
              ng-model="consult.notes"
              class="form-control"
              placeholder="Enter your notes here"
            />
          </div>
          <hr />
          <button type="submit" class="btn btn-primary" id="submit-notes">
            Submit
          </button>
          <button class="btn btn-info" id="submitting-notes" disabled>
            Submitting ...
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- End add notes modal -->

<!-- show history Modal -->
<div
  class="modal fade"
  id="showConsultHistoryModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="showConsultHistoryModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg custom-modal-width" role="document">
    <div class="modal-content">
      <div class="modal-header align-items-start">
        <div>
          <h5 class="modal-title" id="showConsultHistoryModalLabel">History</h5>
          <table>
            <tr>
              <td colspan="2">
                <!-- <strong> Name:</strong> -->
                <h6 class="mb-0 mt-4">{{userHistoryData.name}}</h6>
              </td>
            </tr>
            <tr>
              <td>
                <strong>Email:</strong>
              </td>
              <td>{{userHistoryData.email}}</td>
            </tr>
            <tr>
              <td>
                <strong>Phone:</strong>
              </td>
              <td>
                ({{userHistoryData.country.code}})&nbsp;{{userHistoryData.phone}}
              </td>
            </tr>
            <tr>
              <td>
                <strong>Inquiry About:</strong>
              </td>
              <td>{{userHistoryData.lookingFor}}</td>
            </tr>
            <tr>
              <td>
                <strong>User Type:</strong>
              </td>
              <td>{{userHistoryData.type_of_user}}</td>
            </tr>
            <tr>
              <td>
                <strong>Location:</strong>
              </td>
              <td>{{userHistoryData.city}}</td>
            </tr>
          </table>
        </div>
        <button
          type="button"
          ng-click="blankFormFn()"
          id="closeCreateEditModal"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div data-ng-show="userHistory.length > 0" class="table-responsive-history">
          <table class="table history-table">
            <thead class="history-modal-table-head">
              <tr class="text-nowrap">
                <th scope="col">Status</th>
                <th scope="col">Sub Status</th>
                <th scope="col" class="notes">Notes</th>
                <th scope="col">Whatsapp Number</th>
                <th scope="col">Updated On</th>
                <th scope="col">Updated By</th>
              </tr>
            </thead>
            <tbody>
              <tr
                data-ng-show="userHistory.length > 0"
                ng-repeat="history in userHistory track by $index"
              >
                <td>{{history.status || "-"}}</td>
                <td>{{history.subStatus || "-"}}</td>
                <td class="notes">{{history.notes}}</td>
                <td>({{history.country.code}}) {{history.whatsappNumber}}</td>
                <td>{{history.updated | date: "MMM dd yyyy hh:mm a"}}</td>
                <td>{{history.updatedBy}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div data-ng-show="userHistory.length === 0">
          <h4 class="text-muted">No History</h4>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End show history modal -->
